"use strict";class t{id;type;name;static#t=new Map;static addAlias(t,a,s=null){this.#t.set(t,{alt:a,conversion:s})}#a=null;#s=null;#e=null;#i=[];constructor(a,s,e){this.id=a,this.type=s,this.name=e;const i=t.#t.get(this.name);void 0!==i&&(this.#a=i.alt,this.#s=i.conversion)}get alias(){return this.#a}get conversion(){return this.#s}get value(){return this.#e}set value(t){"number"==typeof t&&isNaN(t)&&(t=null),this.#e=t}get buffer(){let t,a=this.value;if(null===a)throw this.name+" value is invalid";switch(null!==this.conversion&&(a/=this.conversion),this.type){case 0:t=Buffer.allocUnsafe(1),t.writeInt8(Number(a));break;case 1:t=Buffer.allocUnsafe(4),t.writeInt32LE(a);break;case 2:t=Buffer.allocUnsafe(4),t.writeFloatLE(a);break;case 3:t=Buffer.allocUnsafe(8),t.writeDoubleLE(a);break;case 4:t=Buffer.allocUnsafe(4+a.length),t.writeInt32LE(a.length),t.write(a,4);break;case 5:t=Buffer.allocUnsafe(8),t.writeBigInt64LE(a);break;default:throw"buffer type is invalid"}return t}set buffer(t){let a;switch(this.type){case 0:a=Boolean(t.readInt8());break;case 1:a=t.readInt32LE();break;case 2:a=t.readFloatLE();break;case 3:a=t.readDoubleLE();break;case 4:a=t.toString("utf8",4);break;case 5:a=t.readBigInt64LE();break;default:throw"buffer type is not valid"}null!==this.conversion&&(a*=this.conversion),this.value=a}addCallback(t=()=>{}){this.#i.push(t);return this.#i.length}callback(){this.#i.forEach((t=>{t()})),this.#i=[]}}t.addAlias("aircraft/0/name","aircraft"),t.addAlias("simulator/throttle","throttle",-.1),t.addAlias("aircraft/0/systems/landing_gear/lever_state","gear"),t.addAlias("aircraft/0/systems/spoilers/state","spoilers"),t.addAlias("aircraft/0/systems/axes/elevator_trim","trim"),t.addAlias("aircraft/0/systems/flaps/state","flaps"),t.addAlias("aircraft/0/systems/parking_brake/state","parkingbrake"),t.addAlias("aircraft/0/indicated_airspeed","airspeed",1.94384),t.addAlias("aircraft/0/groundspeed","groundspeed",1.94384),t.addAlias("aircraft/0/altitude_msl","altitude"),t.addAlias("aircraft/0/altitude_agl","altitudeAGL"),t.addAlias("aircraft/0/heading_magnetic","heading",180/Math.PI),t.addAlias("aircraft/0/vertical_speed","verticalspeed",196.8504),t.addAlias("aircraft/0/systems/autopilot/vnav/on","vnavon"),t.addAlias("aircraft/0/flightplan/full_info","fplinfo"),t.addAlias("aircraft/0/systems/autopilot/on","autopilot"),t.addAlias("aircraft/0/systems/autopilot/alt/on","alton"),t.addAlias("aircraft/0/systems/autopilot/vs/on","vson"),t.addAlias("aircraft/0/systems/autopilot/spd/on","spdon"),t.addAlias("aircraft/0/systems/autopilot/hdg/on","hdgon"),t.addAlias("aircraft/0/systems/autopilot/nav/on","navon"),t.addAlias("aircraft/0/systems/autopilot/approach/on","approach"),t.addAlias("aircraft/0/systems/autopilot/alt/target","alt",3.28084),t.addAlias("aircraft/0/systems/autopilot/vs/target","vs",3.28084),t.addAlias("aircraft/0/systems/autopilot/spd/target","spd",1.94384),t.addAlias("aircraft/0/systems/autopilot/hdg/target","hdg",180/Math.PI),t.addAlias("aircraft/0/systems/axes/pitch","pitch"),t.addAlias("aircraft/0/systems/axes/roll","roll"),t.addAlias("aircraft/0/systems/axes/yaw","yaw"),t.addAlias("aircraft/0/latitude","latitude"),t.addAlias("aircraft/0/longitude","longitude"),t.addAlias("aircraft/0/magnetic_variation","variation",180/Math.PI),t.addAlias("environment/wind_velocity","wind",1.94384),t.addAlias("environment/wind_direction_true","winddir",180/Math.PI),t.addAlias("aircraft/0/flightplan/route","route"),t.addAlias("aircraft/0/flightplan/coordinates","coordinates"),t.addAlias("aircraft/0/configuration/flaps/stops","flapcount"),t.addAlias("aircraft/0/systems/engines/0/n1","n1",100),t.addAlias("aircraft/0/is_on_ground","onground"),t.addAlias("aircraft/0/is_on_runway","onrunway"),t.addAlias("aircraft/0/systems/auto_brakes/command_state","autobrakes"),t.addAlias("aircraft/0/systems/brakes/left/percentage","leftbrake"),t.addAlias("aircraft/0/systems/brakes/right/percentage","rightbrake"),t.addAlias("aircraft/0/systems/electrical_switch/master_switch/state","master"),t.addAlias("aircraft/0/systems/electrical_switch/nav_lights_switch/state","navlights"),t.addAlias("aircraft/0/systems/electrical_switch/strobe_lights_switch/state","strobelights"),t.addAlias("aircraft/0/systems/electrical_switch/landing_lights_switch/state","landinglights"),t.addAlias("aircraft/0/systems/electrical_switch/beacon_lights_switch/state","beaconlights");const a=require("net"),s=require("dgram");class e{#r;#n="";#l=new a.Socket;#d=null;#o=null;#c=!1;#h=Buffer.alloc(0);#f=new Map;constructor(t){this.#r=t,this.#u(),this.#l.on("data",(t=>{console.log(this.#n+" Rx\t\t\t",t),this.#h=Buffer.concat([this.#h,t]),this.#g()})),this.#l.on("error",(t=>{"ECONNREFUSED"===t.code&&this.log(this.#n+" TCP Connection Refused")})),this.log("TCP Socket Created")}get#p(){return null!==this.#d}#u(){this.#f=new Map,this.addItem(new t(-1,4,"manifest"))}#m(){this.#p&&(clearTimeout(this.#o),this.#o=null,this.#d.close(),this.#d=null)}#v(){this.#p?this.log("Already searching for packets"):(this.log("Searching for UDP packets..."),this.#d=s.createSocket("udp4"),this.#d.on("message",((t,a)=>{let s=a.address;this.log(s+" UDP Packet Found"),this.#m(),this.connect(s)})),this.#d.bind(15e3),this.#o=setTimeout((()=>{this.#m(),this.log("UDP search timed out\n\nTry using an IP address")}),1e4))}#g(){if(this.#h.length<9)return;const t=this.#h.readInt32LE(4)+8;if(this.#h.length<t)return;const a=this.#h.readInt32LE(0),s=this.#h.subarray(8,t);this.#h=this.#h.subarray(t),this.#y(a,s),this.#h.length>0&&this.#g()}#y(a,s){if(-1===a){this.#u();return s.toString().split("\n").forEach((a=>{const s=a.split(","),e=parseInt(s[0]),i=parseInt(s[1]),r=s[2],n=new t(e,i,r);this.addItem(n)})),this.log(this.#n+"\nManifest Built, API Ready"),void this.#r.send("ready",this.#n)}const e=this.getItem(a.toString());void 0!==e&&(e.buffer=s,e.callback())}#A(t,a){let s=Buffer.allocUnsafe(5);return s.writeInt32LE(t),s[4]=a,s}#w(t,a,s,e=!1){const i=e?" =":"",r=e?a.value:"";console.log(this.#n,"Tx",t,"("+a.id.toString()+")"+i,r,s)}log(t){this.#r.send("log",t),console.log(t)}connect(t=""){if(this.#c)return this.log(this.#n+" TCP is already active"),void this.#r.send("ready",this.#n);this.#n=t,""!==this.#n?(this.log(this.#n+" Attempting TCP Connection"),this.#l.connect({host:this.#n,port:10112},(()=>{this.#c=!0,this.log(this.#n+" TCP Established, Requesting Manifest"),this.readState("manifest")}))):this.#v()}close(){this.#p&&this.#m(),this.#c?(this.#c=!1,this.#l.end((()=>{this.log(this.#n+" TCP Closed"),this.#n=""}))):this.log("TCP Closed")}readState(t,a=()=>{}){const s=this.getItem(t);if(void 0===s)return void a();if(-1===s.type)a();else{if(s.addCallback(a)>1)return}const e=this.#A(s.id,0);this.#l.write(e),this.#w(t,s,e)}writeState(t){const a=this.getItem(t);if(void 0===a)return;let s=this.#A(a.id,1);s=Buffer.concat([s,a.buffer]),this.#l.write(s),this.#w(t,a,s,!0)}addItem(t){this.#f.set(t.id.toString(),t),this.#f.set(t.name,t),null!==t.alias&&this.#f.set(t.alias,t)}getItem(t){const a=this.#f.get(t);return void 0===a&&this.log(this.#n+" Invalid Item "+t),a}}const{app:i,BrowserWindow:r,ipcMain:n}=require("electron");let l,d;i.whenReady().then((()=>{const t=new r({width:1600,height:900,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:__dirname+"/preload.js"}});t.loadFile("public/index.html"),l=t.webContents,d=new e(l),console.log("\nLoading Complete, Server Ready\n")})),n.on("start",((t,[a])=>{d.log("Connection Requested"),d.connect(a)})),n.on("stop",(t=>{d.log("Closure Requested"),d.close()})),n.on("read",((t,[a,s])=>{const e=d.getItem(s);d.readState(s,(()=>{l.send("response",a,e?.value??void 0)}))})),n.on("write",((t,[a,s])=>{const e=d.getItem(a);void 0!==e&&(e.value=s,d.writeState(a))})),n.on("ping",((t,[a])=>{const s=performance.now();d.readState("autopilot",(()=>{const t=performance.now()-s;l.send("response",a,t)}))}));