"use strict";class DOMInterface{#t=new Map;constructor(){}#e(t){const e=this.#t.get(t.id);if(void 0===e)return;let a=null;switch(t.type){case"number":a=parseFloat(t.value);break;case"checkbox":a=t.checked;break;case"select-one":a=t.value}"number"==typeof a&&isNaN(a)&&(a=null),e.value=a}#a(t){t.classList.add("error"),setTimeout((()=>{t.classList.remove("error")}),2e3)}add(...t){t.forEach((t=>{if(void 0!==this.#t.get(t))return;const e=document.getElementById(t);if(null===e)return;const a=e;a.addEventListener("change",(()=>{this.#e(a)})),this.#t.set(a.id,{dom:a,value:null}),this.#e(a)}))}load(...t){let e=[];return t.forEach((t=>{const a=this.#t.get(t)?.value;void 0!==a&&e.push(a)})),e}loadAll(){let t=new Map;return this.#t.forEach(((e,a)=>{t.set(a,e.value)})),t}save(t,e){const a=this.#t.get(t);if(void 0===a)return;a.value=e;const n=a.dom;"boolean"!=typeof e?(e=e??"",n.value=e.toString()):n.checked=e}isValid(t=!1,...e){let a=!0;return e.forEach((e=>{const n=this.#t.get(e);if(void 0===n)return!1;const o=null!==n.value;!o&&t&&this.#a(n.dom),a=o&&a})),a}}class ProfileStorage{static defaultName="#default";#n;constructor(t){this.#n=t;const e=ProfileStorage.defaultName;null===localStorage.getItem(e)&&this.save(e),this.#o(),this.load(e)}#o(){let t=[];for(let e=0,a=localStorage.length;e<a;e++)t.push(localStorage.key(e));t.sort(),this.#n.innerHTML="",t.forEach((t=>{let e=new Option(t,t);this.#n.appendChild(e)}))}#i(t,e){const a=document.getElementById(t);null!==a&&(a.classList.remove("off"),a.classList.add(e),setTimeout((()=>{a.classList.remove(e),a.classList.add("off")}),500))}add(t){const e=document.getElementById("profilename");void 0===t&&(t=e.value),e.value="",this.save(t),this.#o(),this.#n.value=t}save(t=this.#n.value){if(""===t)return void this.add();const e=domInterface.loadAll();let a={};e.forEach(((t,e)=>{a[e]=t})),localStorage.setItem(t,JSON.stringify(a)),this.#i("profilesave","active")}load(t=this.#n.value){const e=localStorage.getItem(t);if(""===t||null===e)return void this.#i("load","error");this.#n.value=t;const a=document.getElementById("loadempty").checked,n=JSON.parse(e);for(let t in n){let e=n[t];if(null!==e){let t=parseFloat(e.toString());isNaN(t)||(e=t)}else if(!a)continue;domInterface.save(t,e)}this.#i("profileload","active")}remove(t=this.#n.value){if(""===t)return;confirm("Are you sure you want to delete: "+t)&&(localStorage.removeItem(t),this.#o())}}class Autofunction{delay;#s;#l=null;#r=[];#c=[];#d=!1;#u=!1;#f;memory=new Map;stage=0;constructor(t,e,a,n,o){this.delay=e;const i=document.getElementById(t);if(null===i)throw"Element "+t+" is undefined";this.#s=i,this.#s.addEventListener("click",(()=>{dependencyCheck(t),this.setActive()})),this.#h(),this.#r=a,this.#c=n,this.#f=o,this.#r.forEach((t=>{let e=document.getElementById(t);if(null===e||"INPUT"!==e.tagName||"number"!==e.type)return;const a=e,n=document.getElementById("tooltip");a.addEventListener("mouseenter",(()=>{n.innerText=a.placeholder})),a.addEventListener("mouseout",(()=>{n.innerText="Tooltip"}))})),domInterface.add(...a)}getInputs(){return this.#r}getDependents(){return this.#c}isActive(){return this.#d}setActive(t=!this.#d){if(this.#d!==t){if(this.#d=t,this.#h(),this.#d)return this.stage=0,void this.#g();null!==this.#l&&(clearTimeout(this.#l),this.#l=null)}}#h(t=""){const e=this.#s.classList;""===t&&(t=this.isActive()?"active":"off"),e.contains(t)||(["off","active","armed","error"].forEach((t=>{e.remove(t)})),e.add(t))}async#g(){if(!this.validateInputs(!0))return void this.error();const t=this.#u;this.#u=!1,await this.#f(domInterface.load(...this.#r)),!this.#u&&t&&this.#h(),-1!==this.delay?this.#d&&(this.#l=setTimeout((()=>{this.#l=null,this.#g()}),this.delay)):this.setActive(!1)}validateInputs(t=!1){let e=domInterface.isValid(t,...this.#r);return this.#c.forEach((t=>{e=t.validateInputs()&&e})),e}arm(){this.#u=!0,this.#h("armed")}error(){this.setActive(!1),this.#h("error"),setTimeout((()=>{this.#h()}),2e3)}}class PID{Kp;Ki;Kd;outputMin;outputMax;cyclical;#p=0;#m=0;#v=.1;constructor(t=0,e=0,a=0,n=-1/0,o=1/0,i=!1){this.Kp=t,this.Ki=e,this.Kd=a,this.outputMin=n,this.outputMax=o,this.cyclical=i}#y(t){const e=this.outputMax-this.outputMin;return((t-this.outputMin)%e+e)%e+this.outputMin}#w(t){const e=this.outputMax-this.outputMin,a=this.#y(t);return a>e/2?a-e:a}update(t,e,a){let n=e-t;this.cyclical&&(t=this.#y(t),n=(e=this.#y(e))-t,n=this.#w(n)),this.#m+=this.#v*(n-this.#m);const o=(n-this.#p)/a;this.#p=n;let i=this.Kp*n+this.Ki*this.#m+this.Kd*o;return i=Math.max(i,this.outputMin),i=Math.min(i,this.outputMax),i}}const NMtoFT=6076.12;function dms(t,e=0,a=0){return Math.sign(t)*(Math.abs(t)+e/60+a/3600)}function calcLLfromHD(t,e,a,n=0){e=90-e-n,e*=toRad;const o=(a/=60)*Math.sin(e)+t.lat;return{lat:o,long:a*Math.cos(e)/Math.cos(toRad*(t.lat+o)*.5)+t.long}}function calcLLdistance(t,e){const a=60*(e.lat-t.lat);return((60*(e.long-t.long)*Math.cos(.5*(t.lat+e.lat)*toRad))**2+a**2)**.5}function controlThrottle(t,e,a){write("spdon",!1),write("throttle",t>0?-80:-100),write("spd",e),write("spoilers",1),a&&(write("spdon",!0),write("spoilers",2))}function showfpl(t,e,a){const n=document.createElement("input"),o=document.createElement("br");n.type="number",n.id=t,a.innerHTML+=" "+e,a.appendChild(n),a.appendChild(o)}function nextRestriction(t,e,a,n){return t.identifier!==e.name&&t.name!==e.name||(e.index=a,e.children=n,e.altitude=t.altitude),a>=e.index&&-1!==t.altitude&&(e.altitudeRestriction.push(t.altitude),e.restrictionLocation={lat:t.location.Latitude,long:t.location.Longitude}),e}function speak(t){t=t.toString();const e=document.getElementById("voices").selectedIndex,a=speechSynthesis.getVoices(),n=document.getElementById("utterancerate");let o=parseInt(n.value);isNaN(o)&&(o=1);const i=new SpeechSynthesisUtterance(t);i.rate=o,i.voice=a[e],speechSynthesis.speak(i)}speechSynthesis.getVoices();const toDeg=180/Math.PI,toRad=Math.PI/180;function setAll(t){const e="off"===t;autogear.setActive(e),autospoilers.setActive(e),autotrim.setActive(e),autoflaps.setActive(e),autolights.setActive(e),autobrakes.setActive(e),autospeed.setActive(e);document.getElementById("all").className=e?"active":"off"}function config(){const t=new Map;t.set("autoflaps",{instance:autoflaps,checked:document.getElementById("configflaps").checked}),t.set("autospeed",{instance:autoflaps,checked:document.getElementById("configspeed").checked}),t.set("autotakeoff",{instance:autoflaps,checked:document.getElementById("configtakeoff").checked}),t.set("flypattern",{instance:autoflaps,checked:document.getElementById("configpattern").checked}),t.set("autoland",{instance:autoflaps,checked:document.getElementById("configland").checked});let e=[];t.forEach((t=>{if(!t.checked)return;const a=[t.instance];a.concat(t.instance.getDependents()),a.forEach((t=>{t.getInputs().forEach((t=>{-1===e.indexOf(t)&&e.push(t)}))}))})),e.forEach((t=>{const e=document.getElementById(t);if(null===e||"number"!==e.type)return;const a=prompt(e.placeholder+"\nLeave blank to not change");null!==a&&""!==a&&domInterface.save(t,a)}))}function dependencyCheck(t){"autoland"===t&&autoland.isActive()&&domInterface.load("approach")?domInterface.save("approach",!1):"flypattern"===t&&flypattern.isActive()?(autoland.setActive(!1),flyto.setActive(!1)):"flyto"===t&&flyto.isActive()&&(flypattern.setActive(!1),autoland.setActive(!1))}const server=window.electron;server.on("ready",(([t])=>{document.getElementById("address").value=t,setHidden(!1)})),server.on("log",(([t])=>{log(t)}));const readbacks=new Map;async function readAsync(...t){let e=[];return t.forEach((t=>{e.push(new Promise((e=>{let a=0,n="";for(;n=t+a.toString(),readbacks.has(n);)a++;readbacks.set(n,e),server.send("read",t,n)})))})),Promise.all(e)}async function readLog(...t){await readAsync(...t).then((t=>{console.log(t.join(", "))}))}function write(t,e){server.send("write",t,e)}function bridge(){let t=document.getElementById("address").value;const e=t.split(".");""!==t&&(e.length<2&&(t="1."+t),e.length<3&&(t="168."+t),e.length<4&&(t="192."+t)),server.send("bridge",t)}function closeBridge(){reset(),server.send("break")}function setHidden(t){for(let e=1,a=panels.length;e<a;e++){panels[e].hidden=t}}function reset(){setHidden(!0),autofunctions.forEach((t=>{t.setActive(!1)})),storage.load(ProfileStorage.defaultName)}function log(t){statLog.innerText=t,console.log(t)}server.on("readback",(([t,e])=>{readbacks.get(t)(e),readbacks.delete(t)}));const domInterface=new DOMInterface,statLog=document.getElementById("status"),panels=document.getElementsByClassName("panel"),storage=new ProfileStorage(document.getElementById("profileselect")),select=document.getElementById("voices"),voices=speechSynthesis.getVoices();for(let t=0,e=voices.length;t<e;t++){const e=new Option(voices[t].lang,t.toString());select.add(e)}const autotrim=new Autofunction("trim",1e3,[],[],(async t=>{const e=await readAsync("onground","pitch","trim"),[a,n,o]=e;if(a)return void(0!==o&&write("trim",0));let i=10;if(Math.abs(n)<10?i=1:Math.abs(n)<50&&(i=5),Math.abs(n)>=2){let t=o+i*Math.sign(n);t=Math.round(t/i)*i,write("trim",t)}})),autolights=new Autofunction("lights",2e3,[],[],(async t=>{const e=await readAsync("altitudeAGL","onground","onrunway","gear"),[a,n,o,i]=e;write("master",!0),write("beaconlights",!0),write("navlights",!0),n?(write("strobelights",o),write("landinglights",o)):(write("strobelights",!0),write("landinglights",!!(a<1e3&&i)))})),autogear=new Autofunction("gear",1e3,[],[],(async t=>{const e=await readAsync("gear","altitudeAGL","verticalspeed"),[a,n,o]=e;let i=a;n<100||o<=-500&&n<1200?i=!0:(o>=500||n>=2e3)&&(i=!1),i!==a&&readAsync("commands/LandingGear")})),autobrakes=new Autofunction("autobrakes",1e3,[],[],(async t=>{const e=await readAsync("leftbrake","rightbrake","autobrakes","onground","onrunway","groundspeed"),[a,n,o,i,s,l]=e;let r=o;i&&!s?r=0:i?s&&(r=3):r=2,i&&l>30&&(a>.3||n>.3)&&(r=0),r!==o&&write("autobrakes",r)})),autoflaps=new Autofunction("flaps",1e3,["flaplow","flaphigh","flapto"],[],(async t=>{const e=await readAsync("flaps","airspeed","altitudeAGL","verticalspeed","flapcount","onground","onrunway"),[a,n,o,i,s,l,r]=e,[c,d,u]=t;if(u<0||u>s-1||d<c)return void autoflaps.error();let f=a;if(l)f=r?u:0;else if(o>=250){const t=s-1,e=(d-c)/t;f=Math.round((d-n)/e),f=Math.max(f,0),f=Math.min(f,t)}(i>=500&&f>a||i<=-500&&f<a)&&(f=a),f!==a&&write("flaps",f)})),autospoilers=new Autofunction("spoilers",1e3,[],[],(async t=>{const e=await readAsync("spoilers","airspeed","spd","altitude","altitudeAGL","onrunway","onground"),[a,n,o,i,s,l,r]=e;let c=0;l||!r&&s<1e3?c=2:!r&&(n-o>=20||o>255&&i<1e4)&&i<28e3&&(c=1),c!==a&&write("spoilers",c)})),autospeed=new Autofunction("autospeed",1e3,["latref","longref","climbspd","climbalt","spdref","cruisespd"],[],(async t=>{const e=await readAsync("onground","verticalspeed","altitudeAGL","altitude","latitude","longitude","spd"),[a,n,o,i,s,l,r]=e,[c,d,u,f,h,g]=t,p=domInterface.load("altref")[0];if(a)return void autospeed.arm();const m=null===p?o:i-p;let v=r;if(autoland.isActive()){let t=10*(calcLLdistance({lat:s,long:l},{lat:c,long:d})-2.5)+h;t=Math.min(t,r),t=10*Math.round(t/10),t=Math.max(t,h),v=t}else flypattern.isActive()||i<=f?v=u:i<1e4||i<12e3&&n<=-500?v=250:m>=1e4&&(v=g);v=Math.min(v,g),v!==r&&write("spd",v)})),levelchange=new Autofunction("levelchange",1e3,["flcinput","flcmode"],[],(async t=>{const e=await readAsync("airspeed","altitude","alt"),[a,n,o]=e,[i,s]=t;let l=i;const r=o-n;Math.abs(r)<100?levelchange.setActive(!1):("v"===s&&(l=NMtoFT*Math.tan(l*toRad)),"f"!==s&&(l*=a/60),l*=Math.sign(r),write("vs",l))})),markposition=new Autofunction("markposition",-1,[],[],(async t=>{const e=await readAsync("latitude","longitude","altitude","heading"),[a,n,o,i]=e;domInterface.save("latref",a),domInterface.save("longref",n),domInterface.save("hdgref",Math.round(i)),domInterface.save("altref",Math.round(o))})),setrunway=new Autofunction("setrunway",-1,[],[],(async t=>{const e=await readAsync("route","coordinates"),[a,n]=e,o=a.split(",");let i=-1;for(let t=0,e=o.length;t<e;t++)if(0===o[t].search(/RW\d\d.*/)){i=t;break}if(-1===i)return void setrunway.error();const s=o[i][2]+o[i][3]+"0",l=n.split(" ")[i].split(","),r=parseFloat(l[0]),c=parseFloat(l[1]),d=parseInt(s);domInterface.save("latref",r),domInterface.save("longref",c),domInterface.save("hdgref",d),domInterface.save("altref",null)})),rejecttakeoff=new Autofunction("reject",-1,[],[],(async t=>{const e=await readAsync("onrunway"),[a]=e;if(!a)return rejecttakeoff.error(),void console.log("Not on a runway");autotakeoff.isActive()&&autotakeoff.error(),write("autopilot",!1),write("throttle",-100)})),takeoffconfig=new Autofunction("takeoffconfig",-1,["climbalt","climbtype","flcinputref","flcmoderef"],[],(async t=>{const e=await readAsync("onground","heading","altitude"),[a,n,o]=e,[i,s,l,r]=t;if(!a)return takeoffconfig.error(),void console.log("Not on the ground");let c=i;if("agl"===s){c+=100*Math.round(o/100)}domInterface.save("flcinput",l),domInterface.save("flcmode",r),write("alt",c),write("hdg",n),write("vs",0),write("parkingbrake",!1)})),autotakeoff=new Autofunction("autotakeoff",500,["rotate","climbspd","climbthrottle","takeoffspool","takeofflnav","takeoffvnav"],[takeoffconfig,rejecttakeoff],(async t=>{const e=await readAsync("onground","n1","airspeed"),[a,n,o]=e,[i,s,l,r,c,d]=t,u=2*l-100;let f=autotakeoff.stage;if(0===f){if(!a)return autotakeoff.error(),void console.log("Not on a runway");takeoffconfig.setActive(!0),levelchange.setActive(!1),write("spd",s),write("autopilot",!0),write("alton",!0),write("vson",!1),write("hdgon",!0);write("throttle",r?-20:u),f++}else 1===f?(write("vson",!0),r?(null===n||n>=40)&&(write("throttle",u),f++):f++):2===f?o>=i&&(levelchange.setActive(!0),f++):3===f?s-o<10&&(c&&write("navon",!0),d&&vnavSystem.setActive(!0),write("spdon",!0),f++):autotakeoff.setActive(!1);autotakeoff.stage=f})),flyto=new Autofunction("flyto",1e3,["flytolat","flytolong","flytohdg"],[],(async t=>{const e=await readAsync("latitude","longitude","variation","groundspeed","wind","winddir"),[a,n,o,i,s,l]=e,[r,c,d]=t;function u(t){return t=(t%360+360)%360}if(calcLLdistance({lat:a,long:n},{lat:r,long:c})<1)return void flyto.setActive(!1);const f=r-a,h=(c-n)*Math.cos(.5*(a+r)*toRad);let g=u(Math.atan2(h,f)*toDeg-o);let p=u(d)-g;p>180?p-=360:p<-180&&(p+=360),Math.abs(p)<5?g-=-.1*p**3+8.5*p:g-=30*Math.sign(p);let m=90-g,v=90-u(l-o+180);m*=toRad,v*=toRad;const y=2*i*Math.cos(m),w=2*i*Math.sin(m),A=s*Math.cos(v),I=s*Math.sin(v);g=u(Math.atan2(y-A,w-I)*toDeg),write("hdg",g)})),flypattern=new Autofunction("flypattern",1e3,["latref","longref","hdgref","updist","downwidth","finallength","turnconst","leg","direction","approach"],[],(async t=>{const e=await readAsync("latitude","longitude","variation","groundspeed"),[a,n,o,i]=e,[s,l,r,c,d,u,f,h,g,p]=t,m=r+90*("r"===g?1:-1),v={location:{lat:s,long:l},hdg:r},y=v,w={location:calcLLfromHD(v.location,r,c+1.5,o),hdg:r},A={location:calcLLfromHD(w.location,m,d,o),hdg:m},I={location:calcLLfromHD(v.location,r+180,u,o),hdg:m+180},k={u:w,c:A,d:{location:calcLLfromHD(I.location,m,d,o),hdg:r+180},b:I,f:y}[h],M=calcLLdistance({lat:a,long:n},k.location);let b=h;if(M<i/60/(f/i*60*toRad)){const t=["u","c","d","b","f"];let e=t.indexOf(h);("f"!==h||"f"===h&&M<1)&&(e=(e+1)%5,b=t[e])}"f"===b&&p&&autoland.setActive(!0);const L=k.location.lat,E=k.location.long,S=(k.hdg%360+360)%360;domInterface.save("leg",b),domInterface.save("flytolat",L),domInterface.save("flytolong",E),domInterface.save("flytohdg",S),flyto.setActive(!0)})),goaround=new Autofunction("goaround",-1,["climbalt","climbspd","climbtype","altref","flcinputref","flcmoderef"],[],(async t=>{const e=await readAsync("onground"),[a]=e,[n,o,i,s,l,r]=t;if(a)return goaround.error(),void console.log("Cannot goaround on the ground");autoland.error(),domInterface.save("leg","u"),domInterface.save("flcinput",l),domInterface.save("flcmode",r);let c=n;if("agl"===i){c+=100*Math.round(s/100)}write("spd",o),write("alt",c),write("spdon",!0),write("alton",!0),write("hdgon",!0),levelchange.setActive(!0)})),autoland=new Autofunction("autoland",500,["latref","longref","altref","hdgref","vparef","flare","touchdown","option","flcinputref","flcmoderef"],[flypattern,goaround],(async t=>{const e=await readAsync("latitude","longitude","altitude","groundspeed","onrunway"),[a,n,o,i,s]=e,[l,r,c,d,u,f,h,g,p,m]=t,v=o-c;0===autoland.stage&&(domInterface.save("flcmode","v"),domInterface.save("leg","f"),autoland.stage++);const y=calcLLdistance({lat:a,long:n},calcLLfromHD({lat:l,long:r},d,h/NMtoFT));if(1===autoland.stage&&v<=f)return autoland.stage++,levelchange.setActive(!1),domInterface.save("flcinput",p),void domInterface.save("flcmode",m);if(2===autoland.stage)return write("vs",-200),"p"!==g&&(write("spdon",!1),write("throttle",-100)),void("p"===g?(autoland.setActive(!1),setTimeout((()=>{goaround.setActive(!0)}),1e4)):"l"===g&&s?(autoland.setActive(!1),flypattern.setActive(!1),flyto.setActive(!1),write("autopilot",!1)):"t"===g&&s?(autoland.setActive(!1),setTimeout((()=>{autotakeoff.setActive(!0)}),5e3)):"s"===g&&i<1&&(autoland.setActive(!1),autotakeoff.setActive(!0)));const w=Math.asin(v/(y*NMtoFT))*toDeg;let A=3,I=1;y<=2?(A=1,I=.5):y<=3&&(A=2,I=.75);let k=w-A*(u-w);k=Math.round(100*k)/100,y>3&&(k<u-I||k<u-.25&&0===domInterface.load("flcinput")[0])&&(k=0),k=Math.min(k,u+I),domInterface.save("flcinput",k),write("alt",-1e3),levelchange.setActive(!0),flypattern.setActive(!0),autogear.isActive()&&autogear.setActive("p"!==g)})),updatefpl=new Autofunction("updatefpl",-1,[],[],(async t=>{const e=await readAsync("fplinfo"),[a]=e,n=JSON.parse(a),o=n.detailedInfo.flightPlanItems,i=o.length-1,s=`index${i}children`,l=document.getElementById(s+"0"),r=o[i].children;if(null===r)return;const c=s+(r.length-1).toString(),d=document.getElementById(c);if(null===l||null!==r&&null===d){const t=document.getElementById("waypoints");t.innerHTML="";for(let e=0,a=o.length;e<a;e++){let a;const i=o[e].children;if(null===i)a=n.detailedInfo.waypoints[e],showfpl(`index${e}children0`,a,t);else for(let n=0,o=i.length;n<o;n++)a=i[n].identifier,showfpl(`index${e}children${n}`,a,t)}}})),vnavSystem=new Autofunction("vnav",1e3,[],[],(async t=>{const e=await readAsync("fplinfo","onground","autopilot","groundspeed","altitude","vnavon"),[a,n,o,i,s,l]=e;if(n||!o||l||levelchange.isActive())return void vnavSystem.error();updatefpl.setActive(!0);const r=JSON.parse(a),c=r.detailedInfo.flightPlanItems;let d={name:r.waypointName,index:-1,children:0,altitude:0,altitudeRestriction:[],altitudeRestrictionDistance:0,restrictionLocation:{lat:0,long:0}},u=vnavSystem.stage;for(let t=0,e=c.length;t<e;t++){const e=c[t],a=e.children;if(null===a)d=nextRestriction(e,d,t,0);else for(let e=0;e<a.length;e++)d=nextRestriction(a[t],d,t,e)}const f=`index${d.index}children${d.children}`,h=document.getElementById(f);if(null!==h&&"INPUT"===h.tagName){const t=h.value;""!==t&&r.distanceToNext<=10&&write("spd",t)}if(0===d.altitudeRestriction.length)return speak("No altitude restriction, VNAV disabled"),void vnavSystem.error();if(-1!==d.altitude){const t=(d.altitude-s)/r.eteToNext;write("alt",d.altitude),write("vs",t)}else{d.altitudeRestrictionDistance=calcLLdistance({lat:r.nextWaypointLatitude,long:r.nextWaypointLongitude},d.restrictionLocation);const t=(d.altitudeRestriction[0]-s)/((r.distanceToNext+d.altitudeRestrictionDistance)/i*60);write("alt",d.altitudeRestriction[0]),write("vs",t)}vnavSystem.stage=u}));let calloutFlags=[];const callout=new Autofunction("callout",250,["rotate","minumuns"],[],(async t=>{const e=await readAsync("onrunway","airspeed","verticalspeed","throttle","gear","altitudeAGL","altitude"),[a,n,o,i,s,l,r]=e,[c,d]=t,u=domInterface.load("altref")[0],f=null===u?l:r-u,h=c,g=c+10;let p=callout.stage;0===p&&(calloutFlags=[!1,!1,!1,!1,!1,!1,!1,!1],p++),1===p&&n>=h&&a&&i>40?(speak("V1"),p++):2===p&&n>=c&&a&&i>40?(speak("Rotate"),p++):3===p&&n>=g&&i>40&&(speak("V2"),p++),!speechSynthesis.speaking&&o<-500&&!s&&f<=1e3&&speak("Landing Gear"),!speechSynthesis.speaking&&o<-500&&f<=d+10&&f>=d&&speak("Minimums");const m=[1e3,500,100,50,40,30,20,10];if(o<-500)for(let t=0,e=m.length-1;t<e;t++)if(!speechSynthesis.speaking&&f<=m[t]&&f>m[t+1]&&!calloutFlags[t]){speak(m[t].toString()),calloutFlags[t]=!0;break}callout.stage=p})),autofunctions=[autobrakes,autoflaps,autogear,autoland,autolights,autospeed,autospoilers,autotakeoff,autotrim,callout,flypattern,flyto,goaround,levelchange,markposition,rejecttakeoff,setrunway,takeoffconfig,updatefpl,vnavSystem];